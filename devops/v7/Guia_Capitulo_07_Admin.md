# Manual de Implementação - Capítulo 7: Administração e Conformidade
**Aplicação:** Academia Digital  
**Versão do Guia:** 1.0  
**Objetivo:** Gerir o backoffice administrativo (Faturas, Equipamentos, SIGO).

---

## 1. Dados Administrativos (SQL)

### 1.1. Script Admin
1.  **Script Name:** `07_Admin`.
2.  Código:

```sql
-- CAPÍTULO 7: ADMINISTRAÇÃO

-- 1. Checklist do Dossier Técnico-Pedagógico
CREATE TABLE Itens_Dossier_Turma (
    ID_Item_Dossier NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_Turma NUMBER NOT NULL,
    ID_Tipo_Doc NUMBER NOT NULL, -- FK Tipos_Documento_Dossier
    Presente CHAR(1) DEFAULT 'N',
    URL_Ficheiro VARCHAR2(500),
    Validado_Por VARCHAR2(255),
    Data_Validacao DATE,
    FOREIGN KEY (ID_Turma) REFERENCES Turmas(ID_Turma)
);

-- 2. Faturas de Formadores
CREATE TABLE Faturas_Formadores (
    ID_Fatura NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_Turma NUMBER,
    ID_Formador NUMBER,
    Num_Fatura VARCHAR2(50),      -- [Novo v7]
    Valor NUMBER,
    Mes_Ref VARCHAR2(7), -- YYYY-MM
    Estado VARCHAR2(20),
    Data_Emissao DATE,
    Data_Contabilistica DATE,     -- [Novo v7]
    Data_Pagamento DATE,          -- [Novo v7]
    FOREIGN KEY (ID_Turma) REFERENCES Turmas(ID_Turma),
    FOREIGN KEY (ID_Formador) REFERENCES Entidades(ID_Entidade)
);

-- 3. Equipamentos (Hardware)
CREATE TABLE Equipamentos_Alocados (
    ID_Alocacao NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_Turma NUMBER,
    ID_Tipo_Equipamento NUMBER,
    Quantidade NUMBER,
    Data_Entrega DATE,
    Data_Devolucao DATE,
    Estado_Conservacao VARCHAR2(200),
    FOREIGN KEY (ID_Turma) REFERENCES Turmas(ID_Turma)
);
```
3.  **Executar.**

---

## 2. Interfaces Administrativas

### 2.1. Controlo de Faturação
1.  **Create Page** > **Report**.
2.  **Interactive Report**.
3.  **Page Name:** `Controlo de Faturação`.
4.  **Include Form Page:** Marque esta opção.
5.  **Form Page Name:** `Editar Fatura`.
6.  **Table:** `Faturas_Formadores`.
3.  **Configuração:**
    *   No Report, adicione computações ou destaques (Highlights) para faturas "Em Atraso" (onde `Data_Pagamento` é NULL e `Data_Emissao` > 30 dias).

### 2.2. Dossier Digital
1.  **Create Page** > **Interactive Grid**.
2.  **Table:** `Itens_Dossier_Turma`.
3.  **Funcionalidade:** O coordenador entra na Turma e vê a lista de documentos obrigatórios (Sumários, Pautas, etc.). Marca "Presente" e cola o link do ficheiro.

### 2.3. Exportador SIGO (Relatório)
Precisamos de gerar um CSV para o SIGO.
1.  **Create Page** > **Interactive Report**.
2.  **SQL Query (Baseada em `documentos.md`):**
    ```sql
    SELECT 
        'PE' as Plano,
        t.Cod_Acao_SIGO,
        c.Nome as Curso_DDF,
        t.Codigo_Turma as Num_Acao,
        c.Nome_Curso_SIGO,
        e.Nome_Completo as Formando_Nome,
        e.Email,
        m.Total_Horas,
        t.Data_Inicio,
        t.Data_Fim,
        m.Classificacao_Final
    FROM Matriculas m
    JOIN Turmas t ON m.ID_Turma = t.ID_Turma
    JOIN Cursos c ON t.ID_Curso = c.ID_Curso
    JOIN Entidades e ON m.ID_Aluno = e.ID_Entidade
    WHERE t.ID_Turma = :P_TURMA_ID
    ```
3.  **Download:** Ative a opção de Download CSV no Interactive Report.

---
**Conclusão Capítulo 7:**
O sistema está pronto para produção real, cumprindo os requisitos financeiros e legais.
