# Manual de Implementação - Capítulo 4: Planeamento e Logística
**Aplicação:** Academia Digital  
**Versão do Guia:** 1.0  
**Objetivo:** Operacionalizar os cursos criando Turmas, gerindo Locais e gerando Cronogramas.

---

## 1. Estrutura de Operações (SQL)

Tabelas que ligam o "O Quê" (Cursos) ao "Quando e Onde" (Turmas).

### 1.1. Script de Operações
1.  **SQL Scripts** > **Create** > `04_Operacoes`.
2.  Código SQL:

```sql
-- CAPÍTULO 4: OPERAÇÕES

-- 1. Locais (já criado no Cap 1, mas confirmamos existência. Se não existir, crie aqui)
-- (Tabela Locais já foi definida no script de domínios como base)

-- 2. Turmas (A instância do curso)
CREATE TABLE Turmas (
    ID_Turma NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_Curso NUMBER NOT NULL,
    Codigo_Turma VARCHAR2(100) UNIQUE, -- Gerado automaticamente ex: CURSO-ANO-MES
    Nome_Turma VARCHAR2(200),
    ID_Estado_Turma NUMBER,
    Data_Inicio DATE,
    Data_Fim DATE,
    ID_Local NUMBER,
    Horario_Descritivo VARCHAR2(500), -- Texto livre ex: "2ª e 4ª das 18h às 20h"
    ID_Coordenador NUMBER, -- FK para Entidades
    Vagas NUMBER,
    
    -- Dados Admin/SIGO
    Num_Informacao VARCHAR2(100),
    Num_Informacao_Mae VARCHAR2(100),
    Cod_Acao_SIGO VARCHAR2(100),
    ID_Tipo_Plano NUMBER,
    Avaliacao_Ativa CHAR(1) DEFAULT 'S',
    Observacoes CLOB,
    
    FOREIGN KEY (ID_Curso) REFERENCES Cursos(ID_Curso),
    FOREIGN KEY (ID_Estado_Turma) REFERENCES Tipos_Estado_Turma(ID_Estado_Turma),
    FOREIGN KEY (ID_Local) REFERENCES Locais(ID_Local),
    FOREIGN KEY (ID_Coordenador) REFERENCES Entidades(ID_Entidade)
);

-- 3. Equipa Formativa (Quem dá a turma)
CREATE TABLE Equipa_Formativa (
    ID_Turma NUMBER,
    ID_Formador NUMBER,
    Principal CHAR(1) DEFAULT 'N',
    PRIMARY KEY (ID_Turma, ID_Formador),
    FOREIGN KEY (ID_Turma) REFERENCES Turmas(ID_Turma),
    FOREIGN KEY (ID_Formador) REFERENCES Entidades(ID_Entidade)
);

-- 4. Sessões (O Cronograma detalhado)
CREATE TABLE Sessoes (
    ID_Sessao NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_Turma NUMBER NOT NULL,
    Nome VARCHAR2(200), -- Ex: "Sessão 1: Introdução"
    Data_Sessao DATE NOT NULL,
    Hora_Inicio VARCHAR2(5), -- HH:MM
    Hora_Fim VARCHAR2(5),    -- HH:MM
    Duracao_Horas NUMBER,
    Sumario CLOB,
    ID_Formador NUMBER, -- Pode variar por sessão
    URL_Recursos VARCHAR2(1000),
    FOREIGN KEY (ID_Turma) REFERENCES Turmas(ID_Turma),
    FOREIGN KEY (ID_Formador) REFERENCES Entidades(ID_Entidade)
);
```
3.  **Executar.**

---

## 2. Interface de Planeamento (UI)

### 2.1. Gestão de Turmas
1.  **Create Page** > **Report**.
2.  **Interactive Report**.
3.  **Page Name:** `Gestão de Turmas`.
4.  **Include Form Page:** Marque esta opção.
5.  **Form Page Name:** `Detalhe da Turma`.
6.  **Table:** `TURMAS`.
4.  No **Formulário de Turma**, organize os campos:
    *   **Cabeçalho:** Código, Nome, Estado.
    *   **Datas e Local:** Data Início, Fim, Local, Horário.
    *   **Administrativo:** Nº Informação, SIGO.
5.  Adicione uma região **Interactive Grid** para a `Equipa_Formativa` (Formadores da Turma) ligada pelo `ID_Turma`.

### 2.2. Calendário de Sessões
1.  Na página de Detalhe da Turma, crie uma **Região Calendar**.
2.  **Source:** Tabela `SESSOES`.
3.  **Where Clause:** `ID_TURMA = :P_ID_TURMA`.
4.  **Display Column:** `Nome`.
5.  **Start Date Column:** `Data_Sessao` (Nota: O calendário do APEX precisa de TIMESTAMP para horas, poderá ter de concatenar Data+Hora numa View, mas para visão diária simples serve a Data).

### 2.3. Automação: Gerador de Cronograma (Bónus)
Para evitar criar 30 sessões à mão:
1.  Crie um botão **"Gerar Sessões"** no Form de Turma.
2.  Crie um Processo PL/SQL que corre ao clicar (Submit):
    *   *Lógica simplificada:* Loop da Data Início à Data Fim; Se for dia útil, INSERT INTO Sessoes.
    *   (Este código pode ser refinado mais tarde).

---
**Conclusão Capítulo 4:**
Consegue agora criar uma Turma "LIT_DIG_NOV_2025", definir que ocorre no "Edifício Sede" e atribuir-lhe Formadores.
