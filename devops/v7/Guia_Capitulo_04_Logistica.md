# Manual de Implementação - Capítulo 4: Planeamento e Logística
**Aplicação:** Academia Digital  
**Versão do Guia:** 1.0  
**Objetivo:** Operacionalizar os cursos criando Turmas, gerindo Locais e gerando Cronogramas.

---

## 1. Estrutura de Operações (SQL)

Tabelas que ligam o "O Quê" (Cursos) ao "Quando e Onde" (Turmas).

### 1.1. Script de Operações
1.  **SQL Scripts** > **Create** > `04_Operacoes`.
2.  Código SQL:

```sql
-- CAPÍTULO 4: OPERAÇÕES

-- 1. Locais (já criado no Cap 1, mas confirmamos existência. Se não existir, crie aqui)
-- (Tabela Locais já foi definida no script de domínios como base)

-- 2. Turmas (A instância do curso)
CREATE TABLE Turmas (
    ID_Turma NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_Curso NUMBER NOT NULL,
    Codigo_Turma VARCHAR2(100) UNIQUE, -- Gerado automaticamente ex: CURSO-ANO-MES
    Nome_Turma VARCHAR2(200),
    ID_Estado_Turma NUMBER,
    Data_Inicio DATE,
    Data_Fim DATE,
    ID_Local NUMBER,
    Horario_Descritivo VARCHAR2(500), -- Texto livre ex: "2ª e 4ª das 18h às 20h"
    ID_Coordenador NUMBER, -- FK para Entidades
    Vagas NUMBER,
    
    -- Dados Admin/SIGO
    Num_Informacao VARCHAR2(100),
    Num_Informacao_Mae VARCHAR2(100),
    Cod_Acao_SIGO VARCHAR2(100),
    ID_Tipo_Plano NUMBER,
    Avaliacao_Ativa CHAR(1) DEFAULT 'S',
    Observacoes CLOB,
    
    FOREIGN KEY (ID_Curso) REFERENCES Cursos(ID_Curso),
    FOREIGN KEY (ID_Estado_Turma) REFERENCES Tipos_Estado_Turma(ID_Estado_Turma),
    FOREIGN KEY (ID_Local) REFERENCES Locais(ID_Local),
    FOREIGN KEY (ID_Coordenador) REFERENCES Entidades(ID_Entidade)
);

-- 3. Equipa Formativa (Quem dá a turma)
CREATE TABLE Equipa_Formativa (
    ID_Turma NUMBER,
    ID_Formador NUMBER,
    Principal CHAR(1) DEFAULT 'N',
    PRIMARY KEY (ID_Turma, ID_Formador),
    FOREIGN KEY (ID_Turma) REFERENCES Turmas(ID_Turma),
    FOREIGN KEY (ID_Formador) REFERENCES Entidades(ID_Entidade)
);

-- 4. Sessões (O Cronograma detalhado)
CREATE TABLE Sessoes (
    ID_Sessao NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_Turma NUMBER NOT NULL,
    Nome VARCHAR2(200), -- Ex: "Sessão 1: Introdução"
    Data_Sessao DATE NOT NULL,
    Hora_Inicio VARCHAR2(5), -- HH:MM
    Hora_Fim VARCHAR2(5),    -- HH:MM
    Duracao_Horas NUMBER,
    Sumario CLOB,
    ID_Formador NUMBER, -- Pode variar por sessão
    URL_Recursos VARCHAR2(1000),
    FOREIGN KEY (ID_Turma) REFERENCES Turmas(ID_Turma),
    FOREIGN KEY (ID_Formador) REFERENCES Entidades(ID_Entidade)
);
```
3.  **Executar.**

---

## 2. Interface de Planeamento (UI)

### 2.1. Gestão de Turmas
1.  **Create Page** > **Report**.
2.  **Interactive Report**.
3.  **Page Name:** `Gestão de Turmas`.
4.  **Include Form Page:** Marque esta opção.
5.  **Form Page Name:** `Detalhe da Turma`.
6.  **Table:** `TURMAS`.
4.  No **Formulário de Turma**, organize os campos:
    *   **Cabeçalho:** Código, Nome, Estado.
    *   **Datas e Local:** Data Início, Fim, Local, Horário.
    *   **Administrativo:** Nº Informação, SIGO.
593.  **Adicionar Região Equipa Formativa (IG):**
    *   Clique com o botão direito em "Content Body" > **Create Region**.
    *   **Title:** `Equipa Formativa`.
    *   **Type:** `Interactive Grid`.
    *   **Source Table:** `EQUIPA_FORMATIVA`.
    *   **Where Clause:** `ID_TURMA = :P_ID_TURMA` (Substitua `P_` pelo número da página).
    *   **Page Items to Submit:** `P_ID_TURMA`.
    *   **Master-Detail:** Selecione a coluna `ID_TURMA` da Grid, e na direita defina **Master Region** como a região do formulário da Turma, ou defina **Default Value** > **Item** > `P_ID_TURMA`.
    *   Oculte a coluna `ID_TURMA`.

### 2.2. Calendário de Sessões
1.  Na página de Detalhe da Turma, crie uma **Região Calendar**.
297.  **Source Type:** `SQL Query`.
98.  **SQL Query:**
    ```sql
    SELECT 
        ID_Sessao,
        Nome,
        -- Concatenar Data com Hora para o Calendário saber onde pôr a barra
        TO_DATE(TO_CHAR(Data_Sessao, 'YYYY-MM-DD') || ' ' || Hora_Inicio, 'YYYY-MM-DD HH24:MI') as Data_Inicio_Cal,
        TO_DATE(TO_CHAR(Data_Sessao, 'YYYY-MM-DD') || ' ' || Hora_Fim, 'YYYY-MM-DD HH24:MI') as Data_Fim_Cal
    FROM Sessoes
    WHERE ID_Turma = :P_ID_TURMA
    ```
99.  **Page Items to Submit:** `P_ID_TURMA`.
100. **Display Column:** `Nome`.
101. **Start Date Column:** `Data_Inicio_Cal`.
102. **End Date Column:** `Data_Fim_Cal`.

102. ### 2.3. Automação: Gerador de Cronograma (Bónus)
Para evitar criar 30 sessões à mão:
1.  Crie um botão **"Gerar Sessões"** no Form de Turma (Action: Submit Page).
2.  Crie um Processo (Processing) > **Type:** Execute Code.
3.  **Server-side Condition:** When Button Pressed > "Gerar Sessões".
4.  **PL/SQL Code:**
    ```sql
    DECLARE
        l_data DATE := :P_DATA_INICIO; -- Use os nomes reais dos seus itens (ex: P10_DATA_INICIO)
    BEGIN
        -- Loop da data inicio à data fim
        WHILE l_data <= :P_DATA_FIM LOOP
            -- Se não for Sábado (7) nem Domingo (1)
            IF TO_CHAR(l_data, 'D') NOT IN (1, 7) THEN 
                INSERT INTO Sessoes (ID_Turma, Nome, Data_Sessao, Hora_Inicio, Hora_Fim)
                VALUES (:P_ID_TURMA, 'Sessão Regular', l_data, '18:00', '20:00');
            END IF;
            l_data := l_data + 1;
        END LOOP;
    END;
    ```
    *   *Nota:* O formato de dia da semana (1,7) depende da configuração NLS do servidor. Verifique se 1=Domingo ou 1=Segunda.
    *   Este código assume horário fixo 18-20h para simplificar.

---
**Conclusão Capítulo 4:**
Consegue agora criar uma Turma "LIT_DIG_NOV_2025", definir que ocorre no "Edifício Sede" e atribuir-lhe Formadores.
